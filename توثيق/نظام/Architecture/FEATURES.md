# ✨ FEATURES - الميزات المتقدمة للنظام

> **⚠️ تعليمات:** هذا المستند يوثق الميزات المتقدمة وتفاصيلها التقنية التي تم الاتفاق عليها.

---

## 1. عارض الملفات الاحترافي (Professional Content Viewer)

يهدف النظام إلى توفير تجربة عرض محتوى غنية وتفاعلية داخل المنصة مباشرة، بدلاً من مجرد توفير روابط تحميل.

### 1.1. أنواع العارضين

| نوع المحتوى | التقنية المقترحة | ملاحظات |
| :--- | :--- | :--- |
| **ملفات PDF** | `PDF.js` (by Mozilla) | مكتبة قوية لعرض ملفات PDF مباشرة في المتصفح مع دعم للتكبير والتنقل بين الصفحات. |
| **مقاطع الفيديو** | `Video.js` أو `Plyr.io` | مكتبات تدعم تشغيل الفيديو من روابط مباشرة أو روابط يوتيوب مع واجهة تحكم احترافية. |
| **الصور** | `Lightbox2` أو ما يماثلها | لعرض الصور في نافذة منبثقة (Modal) مع خلفية معتمة. |
| **نصوص Markdown** | `Marked.js` + `DOMPurify` | لعرض محتوى الملخصات والأسئلة المنسقة بصيغة Markdown بشكل آمن وجميل. |

### 1.2. ميزات واجهة العارض

- **الوضع الليلي/النهاري:** سيتم توفير زر لتبديل الألوان باستخدام متغيرات CSS (`CSS Variables`) لتجربة قراءة مريحة.
- **التحكم في الخط:** سيتم توفير أزرار لتكبير وتصغير حجم الخط في عارض نصوص Markdown.
- **وضع القراءة (للملخصات):** سيتم تصميم واجهة خاصة لعرض الملخصات النصية بتركيز عالٍ وبدون مشتتات، تشبه تجربة قراءة الكتب الإلكترونية.

---

## 2. نظام التحويل والتصدير (Conversion & Export Engine)

لزيادة الفائدة من المحتوى المولد بواسطة الذكاء الاصطناعي، سيوفر النظام خيارات تصدير متعددة.

### 2.1. التخزين الأساسي بصيغة Markdown

- جميع المخرجات من وحدة الذكاء الاصطناعي (الملخصات والأسئلة) سيتم تخزينها في قاعدة البيانات بصيغة **Markdown**.
- **السبب:** Markdown لغة خفيفة، مقروءة، وسهلة التحويل إلى صيغ أخرى.

### 2.2. خيارات التصدير المتاحة

عندما يطلب المستخدم تحميل ملخص أو مجموعة أسئلة، ستظهر له الخيارات التالية:

| صيغة التصدير | المكتبة المقترحة (Python) | ملاحظات |
| :--- | :--- | :--- |
| **PDF** | `WeasyPrint` أو `xhtml2pdf` | لتحويل HTML (الناتج من Markdown) إلى ملف PDF أنيق. |
| **DOCX** | `python-docx` | لإنشاء ملف Microsoft Word من النص المنسق. |
| **Markdown (.md)** | - | تصدير مباشر للمحتوى الخام من قاعدة البيانات. |
| **Text (.txt)** | - | تصدير النص بدون أي تنسيق. |

**آلية العمل:** عند طلب التصدير، سيقوم السيرفر (Django) بتنفيذ عملية التحويل في الخلفية وتوفير الملف المحول للمستخدم للتحميل الفوري.


---

## 3. صلاحيات المدرس (Instructor Permissions)

- **الحذف:** يمكن للمدرس حذف الملفات التي رفعها هو فقط. سيتم تنفيذ الحذف كـ **Soft Delete** (تغيير `is_deleted` إلى `True`).
- **التعديل:** يمكن للمدرس تعديل عنوان أو رابط الملفات التي رفعها هو فقط.
- **الرؤية:** يمكن للمدرس رؤية الملفات التي رفعها مدرسون آخرون في نفس المقرر، ولكن لا يمكنه تعديلها أو حذفها.

---

## 4. آلية الإشعارات (Notification Mechanism)

- **الإشعار التلقائي:** عند رفع ملف جديد، يتم إرسال إشعار تلقائي إلى **جميع طلاب المقرر**.
- **الإشعار العام (اختياري):** عند إرسال إشعار، سيكون لدى المدرس خيار (Checkbox) لإرسال الإشعار إلى **جميع طلاب القسم والمستوى** في حال كان الإعلان طارئاً وعاماً.

---

## 5. حدود استخدام الذكاء الاصطناعي (AI Rate Limiting)

- **الحد الأقصى:** **10 طلبات لكل مستخدم في الساعة** لميزات الذكاء الاصطناعي (التلخيص وتوليد الأسئلة).
- **الهدف:** الحفاظ على موارد السيرفر وتكاليف الـ API.


---

## 6. منطق الأرشفة والترقية (Archive & Promotion Logic)

### 6.1. فلسفة الأرشفة (The Archive Philosophy)

- **الهدف:** توفير وصول دائم للمواد الدراسية السابقة دون إرباك الطالب بالمواد الحالية.
- **الآلية:** الأرشفة تُستنتج برمجياً ولا تحتاج لحقل جديد.
  - عندما يقوم الأدمن بتغيير `is_current` في جدول `Semesters` إلى `False` للترم المنتهي، تنتقل جميع المقررات المرتبطة به إلى حالة "مؤرشفة".
  - **استعلام المواد الحالية (التبويب الرئيسي):**
    - `WHERE semester.is_current = True AND course.level_id = student.level_id`
  - **استعلام مواد الأرشيف (تبويب الأرشيف):**
    - `WHERE semester.is_current = False AND course.level_id < student.level_id` (مواد المستويات السابقة التي درسها الطالب)

### 6.2. آلية الترقية (Promotion Engine)

- **الهدف:** تسهيل عملية نقل الطلاب إلى المستوى التالي في نهاية العام الدراسي.
- **الآلية:** سيتم توفير زر "ترقية الطلاب" في لوحة تحكم المسؤول.
  - عند الضغط عليه، يقوم النظام برفع `level_id` لجميع الطلاب من المستوى (ن) إلى المستوى (ن+1) بشكل جماعي.
  - **الشرط:** يجب أن يكون جدول `Levels` يحتوي على حقل `level_number` لتحديد الترتيب المنطقي للترقية.
  - **الكود:** `User.objects.filter(role='Student', level_id=N).update(level_id=N+1)`
