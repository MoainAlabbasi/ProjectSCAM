"""\nاختبارات تطبيق accounts\nS-ACM - Smart Academic Content Management System\n"""\n\nfrom django.test import TestCase, Client\nfrom django.urls import reverse\nfrom django.contrib.auth import get_user_model\nfrom .models import Role, Permission, RolePermission, Major, Level, Semester\n\nUser = get_user_model()\n\n\nclass RoleModelTest(TestCase):\n    """اختبارات نموذج الأدوار"""\n    \n    def setUp(self):\n        """إعداد بيانات الاختبار"""\n        self.admin_role = Role.objects.create(role_name='Admin')\n        self.instructor_role = Role.objects.create(role_name='Instructor')\n        self.student_role = Role.objects.create(role_name='Student')\n    \n    def test_role_creation(self):\n        """اختبار إنشاء الأدوار"""\n        self.assertEqual(Role.objects.count(), 3)\n        self.assertEqual(self.admin_role.role_name, 'Admin')\n    \n    def test_role_str_representation(self):\n        """اختبار تمثيل النص للدور"""\n        self.assertEqual(str(self.admin_role), 'مدير النظام')\n        self.assertEqual(str(self.instructor_role), 'مدرس')\n        self.assertEqual(str(self.student_role), 'طالب')\n\n\nclass PermissionModelTest(TestCase):\n    """اختبارات نموذج الصلاحيات"""\n    \n    def test_permission_creation(self):\n        """اختبار إنشاء الصلاحيات"""\n        permission = Permission.objects.create(\n            permission_name='can_upload_file',\n            description='يمكنه رفع الملفات'\n        )\n        self.assertEqual(permission.permission_name, 'can_upload_file')\n        self.assertEqual(str(permission), 'can_upload_file')\n\n\nclass MajorModelTest(TestCase):\n    """اختبارات نموذج التخصصات"""\n    \n    def test_major_creation(self):\n        """اختبار إنشاء التخصصات"""\n        major = Major.objects.create(major_name='علوم الحاسب')\n        self.assertEqual(major.major_name, 'علوم الحاسب')\n        self.assertTrue(major.is_active)\n\n\nclass LevelModelTest(TestCase):\n    """اختبارات نموذج المستويات"""\n    \n    def test_level_creation(self):\n        """اختبار إنشاء المستويات"""\n        level = Level.objects.create(\n            level_name='المستوى الأول',\n            level_number=1\n        )\n        self.assertEqual(level.level_name, 'المستوى الأول')\n        self.assertEqual(level.level_number, 1)\n    \n    def test_level_ordering(self):\n        """اختبار ترتيب المستويات"""\n        Level.objects.create(level_name='المستوى الثاني', level_number=2)\n        Level.objects.create(level_name='المستوى الأول', level_number=1)\n        Level.objects.create(level_name='المستوى الثالث', level_number=3)\n        \n        levels = list(Level.objects.all())\n        self.assertEqual(levels[0].level_number, 1)\n        self.assertEqual(levels[1].level_number, 2)\n        self.assertEqual(levels[2].level_number, 3)\n\n\nclass SemesterModelTest(TestCase):\n    """اختبارات نموذج الفصول الدراسية"""\n    \n    def test_semester_creation(self):\n        """اختبار إنشاء الفصول الدراسية"""\n        from datetime import date\n        semester = Semester.objects.create(\n            name='الفصل الأول 2025/2026',\n            academic_year='2025/2026',\n            semester_number=1,\n            start_date=date(2025, 9, 1),\n            end_date=date(2026, 1, 15),\n            is_current=True\n        )\n        self.assertEqual(semester.name, 'الفصل الأول 2025/2026')\n        self.assertTrue(semester.is_current)\n    \n    def test_only_one_current_semester(self):\n        """اختبار أن فصل واحد فقط يمكن أن يكون الحالي"""\n        from datetime import date\n        semester1 = Semester.objects.create(\n            name='الفصل الأول 2025/2026',\n            academic_year='2025/2026',\n            semester_number=1,\n            start_date=date(2025, 9, 1),\n            end_date=date(2026, 1, 15),\n            is_current=True\n        )\n        semester2 = Semester.objects.create(\n            name='الفصل الثاني 2025/2026',\n            academic_year='2025/2026',\n            semester_number=2,\n            start_date=date(2026, 2, 1),\n            end_date=date(2026, 6, 15),\n            is_current=True\n        )\n        \n        semester1.refresh_from_db()\n        self.assertFalse(semester1.is_current)\n        self.assertTrue(semester2.is_current)\n\n\nclass UserModelTest(TestCase):\n    """اختبارات نموذج المستخدم"""\n    \n    def setUp(self):\n        """إعداد بيانات الاختبار"""\n        self.admin_role = Role.objects.create(role_name='Admin')\n        self.instructor_role = Role.objects.create(role_name='Instructor')\n        self.student_role = Role.objects.create(role_name='Student')\n        self.major = Major.objects.create(major_name='علوم الحاسب')\n        self.level = Level.objects.create(level_name='المستوى الأول', level_number=1)\n    \n    def test_create_user(self):\n        """اختبار إنشاء مستخدم عادي"""\n        user = User.objects.create_user(\n            academic_id='12345',\n            full_name='أحمد محمد',\n            id_card_number='1234567890',\n            role=self.student_role\n        )\n        self.assertEqual(user.academic_id, '12345')\n        self.assertEqual(user.full_name, 'أحمد محمد')\n        self.assertEqual(user.account_status, 'inactive')\n    \n    def test_create_superuser(self):\n        """اختبار إنشاء مستخدم مدير"""\n        superuser = User.objects.create_superuser(\n            academic_id='admin',\n            password='adminpass123',\n            full_name='مدير النظام',\n            id_card_number='0000000000'\n        )\n        self.assertTrue(superuser.is_staff)\n        self.assertTrue(superuser.is_superuser)\n        self.assertEqual(superuser.account_status, 'active')\n    \n    def test_user_role_methods(self):\n        """اختبار دوال التحقق من الدور"""\n        admin = User.objects.create_user(\n            academic_id='admin1',\n            full_name='مدير',\n            id_card_number='1111111111',\n            role=self.admin_role\n        )\n        instructor = User.objects.create_user(\n            academic_id='inst1',\n            full_name='مدرس',\n            id_card_number='2222222222',\n            role=self.instructor_role\n        )\n        student = User.objects.create_user(\n            academic_id='std1',\n            full_name='طالب',\n            id_card_number='3333333333',\n            role=self.student_role\n        )\n        \n        self.assertTrue(admin.is_admin())\n        self.assertFalse(admin.is_instructor())\n        self.assertFalse(admin.is_student())\n        \n        self.assertFalse(instructor.is_admin())\n        self.assertTrue(instructor.is_instructor())\n        self.assertFalse(instructor.is_student())\n        \n        self.assertFalse(student.is_admin())\n        self.assertFalse(student.is_instructor())\n        self.assertTrue(student.is_student())\n\n\nclass UserPermissionTest(TestCase):\n    """اختبارات صلاحيات المستخدم"""\n    \n    def setUp(self):\n        """إعداد بيانات الاختبار"""\n        self.role = Role.objects.create(role_name='Instructor')\n        self.permission = Permission.objects.create(\n            permission_name='can_upload_file',\n            description='يمكنه رفع الملفات'\n        )\n        RolePermission.objects.create(role=self.role, permission=self.permission)\n        \n        self.user = User.objects.create_user(\n            academic_id='inst1',\n            full_name='مدرس',\n            id_card_number='1234567890',\n            role=self.role\n        )\n    \n    def test_user_has_permission(self):\n        """اختبار التحقق من صلاحية المستخدم"""\n        self.assertTrue(self.user.has_permission('can_upload_file'))\n        self.assertFalse(self.user.has_permission('can_delete_user'))\n